---
import { getLoginCookie } from "@/lib/auth/get-login-cookie";
import Alert from "@/components/ui/alert.astro";

let errorMessage: string | null = null;

if (Astro.request.method === "POST") {
	const data = await Astro.request.formData();
	const email = data.get("email")?.toString();
	const password = data.get("password")?.toString();

	if (!email || !password) {
		errorMessage = "Email and password are required.";
		return;
	}

	try {
		const token = await getLoginCookie(email, password);
		errorMessage = null;

		Astro.response.headers.set("Set-Cookie", token);
		Astro.response.headers.set("HX-Redirect", "/");
	} catch (e) {
		errorMessage = "Login failed.";
	}
}
---

{errorMessage && <Alert type="error" content={errorMessage} />}
