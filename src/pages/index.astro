---
import { AstroSeo } from "@astrolib/seo";
import { getPaginatedPosts } from "@/services/db/requests/posts/get";
import { getUserCount } from "@/services/db/requests/auth";
import Pagination from "@/components/ui/pagination.astro";
import PostTimeline from "@/components/posts/post-timeline/post-timeline";
import SidebarLayout from "@/layouts/sidebar-layout.astro";

const userCount = await getUserCount();
if (userCount === 0) {
	return Astro.redirect("/auth/signup");
}

const { siteSettings } = Astro.locals;

const posts = await getPaginatedPosts({
	page: 1,
	perPage: 10,
});

const { items, pagination } = posts;
---

<AstroSeo
	title={`Home | ${siteSettings.TITLE}`}
	description={siteSettings.DESCRIPTION}
/>

<SidebarLayout contentPadding={false} showFooter>
	<PostTimeline posts={items} />

	<Pagination {...pagination} url="/posts" />
</SidebarLayout>
