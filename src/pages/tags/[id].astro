---
import { pocketClient } from "@/services/pocket/pocket-client";
import BlogLayout from "@/layouts/blog-layout.astro";
import Hero from "@/components/hero.astro";
import PostList from "@/components/posts/post-list.astro";
import Pagination from "@/components/ui/pagination.astro";

const page = parseInt(Astro.url.searchParams.get("page") || "1");
const id = Astro.params.id;

const posts = await pocketClient.collection("posts").getList(page, 20, {
	filter: `tags.id?="${id}"`,
	sort: "-shot_on",
	expand: "tags",
});

const tag = await pocketClient
	.collection("tags")
	.getFirstListItem(`id="${id}"`);

const { items, ...pagination } = posts;

// Clear any categories from name
const tagName = tag.name.replace(/^[^:]*: /, "");
---

<BlogLayout>
	<Hero slot="hero" subtitle=`on #${tagName}` />

	<PostList posts={posts.items} />

	<Pagination {...pagination} url=`/tags/${id}` itemsPerPage={20} />
</BlogLayout>
