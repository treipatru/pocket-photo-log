---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostList from "../../components/PostList.astro";
import { pb } from "../../lib/pb";
import PostListPagination from "../../components/PostListPagination.astro";
import Hero from "../../components/Hero.astro";

const page = parseInt(Astro.url.searchParams.get("page") || "1");
const id = Astro.params.id;

const posts = await pb.collection("posts").getList(page, 20, {
	filter: `tags.id?="${id}"`,
	sort: "-created",
	expand: "tags",
});

const tag = await pb.collection("tags").getFirstListItem(`id="${id}"`);

const { items, ...pagination } = posts;
---

<BaseLayout>
	<Hero slot="hero" subtitle=`on #${tag.name}` />

	<PostList posts={posts.items} />

	<PostListPagination {...pagination} url=`/tags/${id}` />
</BaseLayout>
